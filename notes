TODO
====

 * test fs, rc.start and .stop work
 * set image size (probably with transfer type?)
 * set shooting mode, manual!
 * set capture settings: iso, speed, aperture, compensation
 * capture and download in one go (transfertype.pc.full)

USB pcap and Python
http://wiki.wireshark.org/Tools lists
http://www.mit.edu/~armenb/sharktools/

USB for Scapy here
http://comments.gmane.org/gmane.comp.security.scapy.general/4255

Enable wireshark sniffing
mount -t debugfs / /sys/kernel/debug

Check
https://bitbucket.org/dwaley/usb-reverse-engineering

gphoto2 --camera="Canon PowerShot G3 (normal mode)" --capture-image-and-download

bmRequestType is 0xC0 during read and 0x40 during write.
bRequest is 0x4 if length of data is >1, 0x0c otherwise (length >1 ? 0x04 : 0x0C)
wValue differs between operations.
wIndex is always 0x00
wLength is simply the length of data.

Match remote control commands in wireshark
(usb.capdata[4:4] == 01:02:00:00) && (usb.capdata[68:4] == 13:00:00:12)

... with RC subcommand
(usb.capdata[4:4] == 01:02:00:00) && (usb.capdata[68:4] == 13:00:00:12) && (usb.capdata[80:1] == SUBCMD:)

SET_ZOOM_POS
(usb.capdata[4:4] == 01:02:00:00) && (usb.capdata[68:4] == 13:00:00:12) && (usb.capdata[80:1] == 0B)

Windows initialization RC commands, win_bootstrap.pcap
------------------------------------------------------
0x00 -> init
0x09 -> set transfer mode 0x04 0x00
0x0c -> set zoom position 0x04 0x00
0x0a -> rc get params 0x00
0x10 -> get ext params size 0x00
0x12 -> get ext params 0x04 0x2c
0x0b -> get zoom position 0x00
0x09 -> set transfer mode 0x04 0x03
0x09 -> set transfer mode 0x04 0x03
0x1b -> unknown1
0x1c -> unknown2
0x1b -> unknown1
0x1c -> unknown2
0x1d -> not even documented
0x1d -> many times with different arguments
0x0a ->
0x10
0x12
0x0a




CMD MACRO ON
0000   48 00 00 00 01 02 00 00 00 00 00 00 00 00 00 00
0010   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0020   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0030   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0040   02 00 00 00 13 00 00 12 48 00 00 00 bc ed 12 00
0050   07 00 00 00 30 00 00 00 20 03 01 00 64 00 00 00
0060   01 ff 00 00 03 03 03 30 00 ff 00 ff 00 00 00 7f
0070   ff ff 40 00 28 00 70 00 18 18 ff ff 18 00 38 00
0080   e6 00 9a 03 e6 00 20 00
----->>>>>
0000   1c 00 00 00 01 03 00 00 00 00 00 00 00 00 00 00
0010   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0020   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0030   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0040   02 00 00 00 13 00 00 22 1c 00 00 00 bc ed 12 00
0050   00 00 00 00 07 00 00 00 00 00 00 00

CMD MACRO OFF
0000   18 00 00 00 01 02 00 00 00 00 00 00 00 00 00 00
0010   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0020   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0030   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0040   02 00 00 00 13 00 00 12 18 00 00 00 b8 ed 12 00
0050   0a 00 00 00 00 00 00 00
----->>>>>
0000   4c 00 00 00 01 03 00 00 00 00 00 00 00 00 00 00
0010   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0020   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0030   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0040   02 00 00 00 13 00 00 22 4c 00 00 00 b8 ed 12 00
0050   00 00 00 00 0a 00 00 00 30 00 00 00 20 03 01 00
0060   64 00 00 00 01 ff 00 00 03 03 03 30 00 ff 00 ff
0070   00 00 00 7f ff ff 40 00 28 00 70 00 18 18 ff ff
0000   18 00 38 00 e6 00 9a 03 e6 00 20 00


LOCK
0000   18 00 00 00 01 02 00 00 00 00 00 00 00 00 00 00
0010   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0020   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0030   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0040   02 00 00 00 13 00 00 12 18 00 00 00 fc f0 12 00
0050   16 00 00 00 00 00 00 00
----->>>>>
0000   1c 00 00 00 01 03 00 00 00 00 00 00 00 00 00 00
0010   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0020   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0030   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0000   02 00 00 00 13 00 00 22 1c 00 00 00 fc f0 12 00
0010   00 00 00 00 16 00 00 00 00 00 00 00

UNLOCK
0000   18 00 00 00 01 02 00 00 00 00 00 00 00 00 00 00
0010   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0020   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0030   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0040   02 00 00 00 13 00 00 12 18 00 00 00 fc f0 12 00
0050   17 00 00 00 00 00 00 00
----->>>>>
0000   1c 00 00 00 01 03 00 00 00 00 00 00 00 00 00 00
0010   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0020   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0030   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0000   02 00 00 00 13 00 00 22 1c 00 00 00 fc f0 12 00
0010   00 00 00 00 17 00 00 00 00 00 00 00